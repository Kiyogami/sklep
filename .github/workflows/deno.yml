name: Deno Build

on: [push, pull_request]

jobs:
  deno:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Deno
        uses: denoland/setup-deno@v2
        with:
          deno-version: v2.x  # zmień na v1.x jeśli Twój kod wymaga starszej wersji

      - name: Cache Deno
        uses: actions/cache@v4
        with:
          path: ~/.deno
          key: deno-${{ hashFiles('deno.lock', 'deno.json*', '**/deno.lock', '**/deno.json*') }}

      - name: Cache & install dependencies
        run: deno cache --reload main.ts   # ZMIEŃ main.ts na rzeczywisty entrypoint (np. backend/server.ts, app.ts)

      - name: Build with Deno
        run: deno task build --allow-scripts   # musi istnieć w deno.json "tasks": {"build": "..."}

      - name: Run tests (opcjonalnie)
        run: deno task test || true

      - name: Lint
        run: deno lint
